# Docker Compose Override for STAGING Environment
# Usage: docker compose -f docker-compose.yml -f docker-compose.staging.yml up -d
#
# This file overrides the base docker-compose.yml with staging-specific settings.
# It uses the STAGING Supabase branch for database isolation from production.

version: '3.8'

services:
  fastapi:
    container_name: sidekick-forge-staging-fastapi
    env_file:
      - .env.staging
    environment:
      # Staging Supabase branch - must override base docker-compose values
      - SUPABASE_URL=https://senzircaknleviasihav.supabase.co
      - SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNlbnppcmNha25sZXZpYXNpaGF2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTEwNjc3OSwiZXhwIjoyMDg0NjgyNzc5fQ.kIWw3LXbznZLk0dMUA4_i4s4R2y5GQbnqmpHIUDSMJk
      - SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNlbnppcmNha25sZXZpYXNpaGF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxMDY3NzksImV4cCI6MjA4NDY4Mjc3OX0.vD-l1caDv5Gv6zCD1-sgGeR5HYPumFXz1RYUFb7QKUU
      # Override other values
      - APP_ENV=staging
      - DEVELOPMENT_MODE=true
      - AGENT_NAME=sidekick-agent-staging
      - LIVEKIT_AGENT_NAME=sidekick-agent-staging
      - DOMAIN_NAME=staging.sidekickforge.com
    # Override .env mount to use staging config
    volumes:
      - ./.env.staging:/app/.env:ro

  agent-worker:
    container_name: sidekick-forge-staging-agent
    env_file:
      - .env.staging
    environment:
      # Staging Supabase branch - must override base docker-compose values
      - SUPABASE_URL=https://senzircaknleviasihav.supabase.co
      - SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNlbnppcmNha25sZXZpYXNpaGF2Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTEwNjc3OSwiZXhwIjoyMDg0NjgyNzc5fQ.kIWw3LXbznZLk0dMUA4_i4s4R2y5GQbnqmpHIUDSMJk
      - SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNlbnppcmNha25sZXZpYXNpaGF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxMDY3NzksImV4cCI6MjA4NDY4Mjc3OX0.vD-l1caDv5Gv6zCD1-sgGeR5HYPumFXz1RYUFb7QKUU
      # Platform Supabase (for platform_api_keys table)
      - PLATFORM_SUPABASE_URL=https://eukudpgfpihxsypulopm.supabase.co
      - PLATFORM_SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV1a3VkcGdmcGloeHN5cHVsb3BtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzUxMjkyMiwiZXhwIjoyMDY5MDg4OTIyfQ.wOSF5bSdd763_PVyCmSEBGjtbhP67WMfms1aGydO_44
      - AGENT_NAME=sidekick-agent-staging
      - DOMAIN_NAME=staging.sidekickforge.com

  redis:
    container_name: sidekick-forge-staging-redis

  nginx:
    container_name: sidekick-forge-staging-nginx

  bge-service:
    container_name: sidekick-forge-staging-bge-service

networks:
  platform-network:
    name: sidekick-forge-staging-network

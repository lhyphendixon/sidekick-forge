// ... existing code ...

## High Priority (Critical for Stability and Core Features)
- **Health Check Timeouts in Containers**: Containers frequently marked as "unhealthy" due to slow health checks (e.g., 21-second timeouts), causing dispatch failures and HTTP timeouts in trigger endpoint. Deeper context: Dockerfile HEALTHCHECK uses curl to /health with 10s timeout, but aiohttp server in health_server.py may delay during startup (e.g., metrics/prometheus init). Manual logs show stuck processes on port 8080 leading to bind errors. Affects agent responsiveness. Files: docker/agent/agent/health_server.py (async server with metrics), app/services/container_manager.py (healthcheck config with 10s timeout, 30s interval), Dockerfile. Fix: Simplify to immediate "OK" response (as in simple_health.py from manual), reduce start-period to 10s, add port conflict detection in startup.sh.
- **Job Dispatch Silent Failures**: No logs for job acceptance despite worker registration; mismatches between console (agent joins) and container logs (no activity). Deviates from LiveKit SDK job handling. Deeper context: trigger.py's spawn_agent_container uses ps aux to check for 'backend_worker.py' but may miss if process is stuck (e.g., PID 222823 in logs consuming connections). Grep shows idle timeouts in CONTAINERIZED_AGENTS.md but no enforcement. Files: app/api/v1/trigger.py (spawn_agent_container trusts "main agent" without verification), app/services/livekit_worker.py, docker/start_client_agent.py (health endpoints). Fix: Add explicit dispatch confirmation, process monitoring, and logging for job_request callbacks; kill stuck PIDs via script.
- **Missing or Renamed Files**: agent_orchestrator.py referenced in history but not found (tool error). Possible deletion without updates to dependents. Deeper context: Likely refactored into backend_worker.py or health_monitor.py; grep shows imports in start_client_agent.py but potential dangling references. Affects orchestration. Files: docker/client_runtime/ (missing file), app/services/agent_service.py, docker/client_runtime/health_monitor.py (now handles some orchestration). Fix: Restore or refactor to use current equivalents (e.g., backend_worker.py), update imports, add file existence checks.
- **API Key Initialization Errors**: Inconsistent passing of keys (e.g., DEEPGRAM missing in old containers), leading to pipeline init failures. Deeper context: container_manager.py passes keys via env_vars but falls back to settings; health_monitor.py checks storage but not keys explicitly. Manual bash shows env grep succeeding post-restart but fails initially due to old images. Files: docker/client_runtime/health_monitor.py (logs errors), app/api/v1/trigger.py (client settings), app/services/container_manager.py (env_vars setup). Fix: Centralize key validation in a startup hook with retries, explicit logging, and Supabase sync checks.

## Medium Priority (Improve Reliability and Maintainability)
- **Incomplete Text Mode Implementation**: TODO in handle_text_trigger for AI integration; currently returns placeholder response. Inconsistent with voice mode. Deeper context: Relies on webhooks but no error handling for failures; api_keys_available uses __dict__ which may fail on non-object types. Files: app/api/v1/trigger.py. Fix: Implement webhook calls or API integrations (e.g., Groq/OpenAI) using client keys, add try-except for key access.
- **Logging Gaps in Event Handlers**: Sparse logging for LiveKit events (e.g., track published, speech detection) despite SDK requirements. Deeper context: health_server.py has basic logging but no event-specific traces; grep shows logger.error in many places without structured output. Files: app/integrations/livekit_client.py, docker/agent/agent_entrypoint.py (assuming from history), docker/agent/agent/health_server.py (could extend for events). Fix: Add logger.info for key events in pipelines, integrate with Prometheus for metrics.
- **Deprecated Build Tools**: Docker builds use legacy builder (DEPRECATED warnings), causing timeouts. Deeper context: Manual bash shows 5m timeouts during pip installs (heavy deps like livekit); partial images created (<none> tags). Files: Dockerfile (pip install), docker-compose.yml. Fix: Migrate to Buildx for faster, modern builds; cache deps or use multi-stage builds.
- **Legacy Code Remnants**: References to old agents (e.g., autonomite_agent_v1_1_19_text_support.py) and heavy-client patterns, conflicting with thin-client architecture. Deeper context: trigger.py checks for specific scripts via ps aux, ignoring containerized setup; manual shows updates to minimal_agent.py removing health integration. Files: app/api/v1/trigger.py (ps aux check), app/services/agent_spawner.py. Fix: Remove legacy checks, fully transition to containerized workers; update to use container_manager.py for all spawns.
- **Error Handling Inconsistencies**: Many logger.error calls without raising user-facing exceptions or retries. Deeper context: Grep shows raise HTTPException in routes but not in async helpers; container_manager.py has broad except Exception without specifics. Files: Throughout (grep shows many in agent_orchestrator equivalents, trigger.py, health_monitor.py). Fix: Standardize with try-except blocks that propagate HTTPExceptions, add retry decorators for Docker ops.

## Low Priority (Optimizations and Cleanups)
- **Inconsistent Room Management**: ensure_livekit_room_exists uses arbitrary sleeps (0.2s); potential race conditions. Deeper context: Grep shows sleeps in various places (e.g., start_agent.sh has sleep 2); no polling in trigger.py. Files: app/api/v1/trigger.py. Fix: Replace with polling or webhook waits using LiveKit API.
- **Testing Coverage Gaps**: Tests pass but miss edge cases like multi-container conflicts or key failures. Deeper context: test_mission_critical.py has PASS for health/agent ops but manual runs show ReadTimeout in full tests; no tests for port conflicts or build timeouts. Files: scripts/test_mission_critical.py (from search), app/tests/. Fix: Add unit tests for dispatch and health, including timeout simulations.
- **Documentation TODOs**: Scattered FIXME/BUG comments without resolution tracking. Deeper context: Grep shows many TODO/FIXME in md files like CONTAINERIZED_AGENTS.md (idle timeouts). Files: Various (grep results). Fix: Review and address or migrate to this list.
- **Scalability Issues**: No limits on concurrent sessions in orchestrator, risking overload. Deeper context: health_monitor.py tracks active_sessions but no enforcement; container_manager.py sets cpu/mem limits but no session caps. Files: docker/client_runtime/health_monitor.py (metrics but no enforcement), app/services/container_manager.py (cpu_quota). Fix: Add max_concurrent_sessions checks with rejection logic.

Last updated: [Current Date]. Review and prioritize during sprints. Added deeper context from health_server analysis, grep on timeouts, container_manager healthchecks, and manual logs (e.g., port conflicts, build timeouts).